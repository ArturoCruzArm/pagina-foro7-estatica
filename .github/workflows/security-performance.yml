name: Security & Performance Check

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  security:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check for secrets in code
        run: |
          echo "ðŸ” Scanning for potential secrets..."
          # Check for common secret patterns
          if grep -rE "(api[_-]?key|password|secret|token)\s*[:=]" --include="*.js" --include="*.html" --include="*.css" . 2>/dev/null | grep -v "node_modules" | head -20; then
            echo "âš ï¸ Potential secrets found - please review"
          else
            echo "âœ… No obvious secrets detected"
          fi
        continue-on-error: true

      - name: Check security headers in HTML
        run: |
          echo "ðŸ”’ Checking security best practices..."
          if grep -q "Content-Security-Policy" index.html 2>/dev/null; then
            echo "âœ… CSP meta tag found"
          else
            echo "â„¹ï¸ Consider adding Content-Security-Policy"
          fi
          if grep -q "X-Content-Type-Options" index.html 2>/dev/null; then
            echo "âœ… X-Content-Type-Options found"
          else
            echo "â„¹ï¸ Consider adding X-Content-Type-Options"
          fi
          echo "âœ… Security check completed"
        continue-on-error: true

  web-vitals:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Analyze file sizes
        run: |
          echo "ðŸ“Š Analyzing file sizes for performance..."
          echo ""
          echo "=== Main Files ==="
          ls -lh index.html styles.css script.js 2>/dev/null || echo "Some files not found"
          echo ""
          echo "=== Total Size ==="
          du -ch index.html styles.css script.js 2>/dev/null | grep total || echo "Unable to calculate"
          echo ""
          echo "âœ… Core Web Vitals optimizations:"
          echo "  - CSS and JS minified in deploy workflow"
          echo "  - Images use lazy loading"
          echo "  - Fonts preloaded"

  accessibility:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check accessibility basics
        run: |
          echo "â™¿ Checking accessibility basics..."

          # Check for alt attributes on images
          IMG_COUNT=$(grep -c "<img" index.html 2>/dev/null || echo "0")
          ALT_COUNT=$(grep -c "alt=" index.html 2>/dev/null || echo "0")
          echo "Images: $IMG_COUNT, With alt: $ALT_COUNT"

          # Check for aria-labels
          ARIA_COUNT=$(grep -c "aria-" index.html 2>/dev/null || echo "0")
          echo "ARIA attributes found: $ARIA_COUNT"

          # Check for semantic HTML
          if grep -q "<header" index.html && grep -q "<main" index.html && grep -q "<footer" index.html; then
            echo "âœ… Semantic HTML structure detected"
          else
            echo "â„¹ï¸ Consider using semantic HTML elements"
          fi

          # Check for lang attribute
          if grep -q 'lang="' index.html; then
            echo "âœ… Language attribute present"
          else
            echo "âš ï¸ Missing lang attribute on html tag"
          fi

          echo ""
          echo "âœ… Accessibility check completed"
